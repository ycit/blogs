# 缓存

## 缓存问题

### 缓存穿透

- What

  查询数据库中一定不存在的数据，这样每次都会绕过缓存直接打到数据库

- How

  - 缓存空值，但是需要设置过期时间。

    > 
    >
    > 存在问题：内存中会存在大量不存在的key的数据

  - 布隆过滤器 BloomFilter

    > 比特向量，n 个 哈希函数算出的哈希值，结果置为1
    >
    > 当输入一个值时，算出n 个哈希值，看其向量是否为1，如果不是1，则一定不存在，如果是1，可能存在也可能不存在
    >
    > 算出不存在的值一定不存在，算出存在的值也可能不存在，牺牲正确率来换取空间。
    >
    > 在缓存之前加一层 BloomFilter，记录已有缓存的key，查询的时候先去 BloomFilter 查询，如果不存在就直接返回，存在再接着查询缓存，查询 db.

### 缓存击穿

- What

  大量的请求同时查询同一个 key，而此时 key 的缓存正好失效，这时就会导致大量的请求打到数据库。

- How

  添加互斥锁：第一个查询数据的请求使用互斥锁来锁住，其他线程拿不到锁就一直等待，直到第一个线程查询到数据，设置了缓存，那么后面的线层就会直接走缓存。